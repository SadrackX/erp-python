{% extends 'base.html' %}
{% block conteudo %}
    <h3>Clientes</h3>
    <!-- Botão para abrir o modal de novo cliente -->
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#clienteModal">
      Novo Cliente
    </button>
    <hr>
    <h4>Lista de Clientes</h4>
    <table class="table table-striped" border="1" cellpadding="5" cellspacing="0">
        <thead class="thead-dark">
            <tr>
                <th scope="col">Nome</th>
                <th scope="col">CPF/CNPJ</th>
                <th scope="col">Telefone</th>
                <th scope="col">Endereco</th>
                <th scope="col">CEP</th>
                <th scope="col">Ações</th>
            </tr>
        </thead>
        {% for cliente in clientes %}
        <tr>
            <td>{{ cliente.nome }}</td>
            <td>{{ cliente.cpf_cnpj }}</td>
            <td>{{ cliente.celular }}</td>
            <td>{{ cliente.endereco }}, {{ cliente.bairro }}, {{ cliente.cidade }}-{{ cliente.uf }}</td>
            <td>{{ cliente.cep }}</td>
            <td>
                <button type="button" class="btn btn-sm btn-warning" data-toggle="modal" data-target="#editarClienteModal{{ cliente.id }}">Editar</button>
            </td>
        </tr>
        {% include 'partials/modal_editar_cliente.html' %}
        {% endfor %}
    </table>

    {% include 'partials/modal_novo_cliente.html' %}

<script>
function validarCpfCnpj(valor) {
    valor = valor.replace(/\D/g, '');
    if (valor.length === 11) {
        // Validação simples de CPF
        return /^\d{11}$/.test(valor);
    } else if (valor.length === 14) {
        // Validação simples de CNPJ
        return /^\d{14}$/.test(valor);
    }
    return false;
}
function validarCep(valor) {
    return /^\d{5}-?\d{3}$/.test(valor);
}
function adicionarValidacaoCliente(form) {
    form.addEventListener('submit', function(e) {
        var cpfCnpj = form.querySelector('[name="cpf_cnpj"]').value;
        var cep = form.querySelector('[name="cep"]').value;
        var msg = '';
        if (!validarCpfCnpj(cpfCnpj)) {
            msg += 'CPF/CNPJ inválido!\n';
        }
        if (!validarCep(cep)) {
            msg += 'CEP inválido!\n';
        }
        if (msg) {
            alert(msg);
            e.preventDefault();
        }
    });
}
document.addEventListener('DOMContentLoaded', function() {
    // Modal novo cliente
    var formNovo = document.querySelector('#clienteModal form');
    if (formNovo) adicionarValidacaoCliente(formNovo);
    // Modais de edição
    document.querySelectorAll('[id^="editarClienteModal"] form').forEach(function(form) {
        adicionarValidacaoCliente(form);
    });
});
</script>
{% endblock %}